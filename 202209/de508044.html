<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>第五届美团CTF初赛&amp;决赛Crypto wp - zealot&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="zealot&#039;s blog"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="zealot&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="被师傅们带进决赛了，tql呜呜呜。"><meta property="og:type" content="article"><meta property="og:title" content="第五届美团CTF初赛&amp;决赛Crypto wp"><meta property="og:url" content="https://litao6666.github.io/202209/de508044.html"><meta property="og:site_name" content="zealot&#039;s blog"><meta property="og:description" content="被师傅们带进决赛了，tql呜呜呜。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://litao6666.github.io/img/og_image.png"><meta property="article:published_time" content="2022-09-26T01:19:27.000Z"><meta property="article:modified_time" content="2022-09-29T14:18:10.650Z"><meta property="article:author" content="zealot"><meta property="article:tag" content="LWE"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://litao6666.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://litao6666.github.io/202209/de508044.html"},"headline":"zealot's blog","image":["https://litao6666.github.io/img/og_image.png"],"datePublished":"2022-09-26T01:19:27.000Z","dateModified":"2022-09-29T14:18:10.650Z","author":{"@type":"Person","name":"zealot"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject"}},"description":"被师傅们带进决赛了，tql呜呜呜。"}</script><link rel="canonical" href="https://litao6666.github.io/202209/de508044.html"><meta name="referrer" content="no-referrer"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/globalUtils.min.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/live2d/waifu.min.css"><script type="text/javascript" async src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/live2d/autoload.min.js"></script><meta name="generator" content="Hexo 6.0.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">zealot&#039;s blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/LittleYe233/hexo-theme-amazingremake"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/theme-setting.min.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-09-26  <span class="level-item"><i class="far fa-clock"> </i>8 m  <i class="fas fa-pencil-alt"> </i>1.2 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">第五届美团CTF初赛&amp;决赛Crypto wp</h1><div class="content"><p>被师傅们带进决赛了，tql呜呜呜。</p>
<span id="more"></span>
<h3 id="初赛strange_rsa1">[初赛]strange_rsa1</h3>
<p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> RealField</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag1</span><br><span class="line"></span><br><span class="line">Bits = <span class="number">512</span></span><br><span class="line">p = getPrime(Bits)</span><br><span class="line">q = getPrime(Bits)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">gift = RealField(prec=Bits*<span class="number">2</span>)(p) / RealField(prec=Bits*<span class="number">2</span>)(q)</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">m = bytes_to_long(flag1)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">output = <span class="built_in">open</span>(<span class="string">'output.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">output.write(<span class="string">'n = '</span> + <span class="built_in">str</span>(n) + <span class="string">'\n'</span>)</span><br><span class="line">output.write(<span class="string">'c = '</span> + <span class="built_in">str</span>(c) + <span class="string">'\n'</span>)</span><br><span class="line">output.write(<span class="string">'gift = '</span> + <span class="built_in">str</span>(gift) + <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>
<p>直接在给定的实数域上求根，然后转整数得到 q，解 RSA 即可。</p>
<p>解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = <span class="number">108525167048069618588175976867846563247592681279699764935868571805537995466244621039138584734968186962015154069834228913223982840558626369903697856981515674800664445719963249384904839446749699482532818680540192673814671582032905573381188420997231842144989027400106624744146739238687818312012920530048166672413</span></span><br><span class="line">c = <span class="number">23970397560482326418544500895982564794681055333385186829686707802322923345863102521635786012870368948010933275558746273559080917607938457905967618777124428711098087525967347923209347190956512520350806766416108324895660243364661936801627882577951784569589707943966009295758316967368650512558923594173887431924</span></span><br><span class="line">gift = <span class="number">0.9878713210057139023298389025767652308503013961919282440169053652488565206963320721234736480911437918373201299590078678742136736290349578719187645145615363088975706222696090029443619975380433122746296316430693294386663490221891787292112964989501856435389725149610724585156154688515007983846599924478524442938</span></span><br><span class="line"></span><br><span class="line">F=RealField(prec=<span class="number">512</span>*<span class="number">2</span>)</span><br><span class="line">R.&lt;x&gt;=PolynomialRing(F)</span><br><span class="line">f=x*x*gift-n</span><br><span class="line">r=f.roots()[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">q=<span class="built_in">int</span>(<span class="built_in">abs</span>(r))</span><br><span class="line">p=n//q</span><br><span class="line">d=inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment">#b'flag{a5537b232c1ab750e0db61ec352504a301b7b212}'</span></span><br></pre></td></tr></table></figure>
<h3 id="初赛strange_rsa2">[初赛]strange_rsa2</h3>
<p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag1, flag2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_poly</span>(<span class="params">modulus, num, root</span>):</span><br><span class="line">    poly = []</span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, num+<span class="number">1</span>):</span><br><span class="line">        poly.append(getRandomRange(<span class="number">1</span>, modulus-<span class="number">1</span>))</span><br><span class="line">        res = (res + poly[-<span class="number">1</span>] * <span class="built_in">pow</span>(root, i, modulus)) % modulus</span><br><span class="line">    <span class="keyword">return</span> [modulus-res] + poly</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Bits = <span class="number">512</span></span><br><span class="line">p = getPrime(Bits)</span><br><span class="line">q = getPrime(Bits)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">a = getRandomRange(<span class="number">1</span>, p-<span class="number">1</span>)</span><br><span class="line">k = bytes_to_long(flag1)</span><br><span class="line">gift = [generate_poly(p, Bits, a), generate_poly(p, Bits, k * a)]</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">m = bytes_to_long(flag2)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">output = <span class="built_in">open</span>(<span class="string">'output.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">output.write(<span class="string">'n = '</span> + <span class="built_in">str</span>(n) + <span class="string">'\n'</span>)</span><br><span class="line">output.write(<span class="string">'c = '</span> + <span class="built_in">str</span>(c) + <span class="string">'\n'</span>)</span><br><span class="line">output.write(<span class="string">'gift = '</span> + <span class="built_in">str</span>(gift) + <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>
<p>注意这题用到了上题的 flag（本题的坑点）。</p>
<p>给出了两个随机多项式，我的想法是构造二元多项式，用 grobner 基求出
a。由于模数 p 未知，先用 n 替代。然而解完惊奇地发现顺带把 p
直接规约出来了，属于是意外收获了。后面解RSA 就 OK 了。</p>
<p>解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">my_poly</span>(<span class="params">coe,x</span>):</span><br><span class="line">	res=<span class="number">0</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">513</span>):</span><br><span class="line">		res+=coe[i-<span class="number">1</span>]*(x^i)</span><br><span class="line">	<span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">flag1 = <span class="string">b'flag{a5537b232c1ab750e0db61ec352504a301b7b212}'</span></span><br><span class="line">k = bytes_to_long(flag1)</span><br><span class="line"><span class="built_in">exec</span>(<span class="built_in">open</span>(<span class="string">'output.txt'</span>,<span class="string">'r'</span>).read())</span><br><span class="line">R.&lt;a,t&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">s1=gift[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">coe1=gift[<span class="number">0</span>][<span class="number">1</span>:]</span><br><span class="line">s2=gift[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line">coe2=gift[<span class="number">1</span>][<span class="number">1</span>:]</span><br><span class="line">f1=my_poly(coe1,a)+s1</span><br><span class="line">f2=my_poly(coe2,t)+s2</span><br><span class="line"></span><br><span class="line">res=Ideal([f1,f2,t-k*a]).groebner_basis()</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line">res=[ x.constant_coefficient() <span class="keyword">for</span> x <span class="keyword">in</span> res]</span><br><span class="line">a,t,p=<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,res))</span><br><span class="line"><span class="built_in">print</span>(a,t,p)</span><br><span class="line">q=n//p</span><br><span class="line">d=inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m)))</span><br><span class="line"><span class="comment">#b'flag{e6d7511d75bd537e1bd0cd08abea415f5f27d6cf}'</span></span><br></pre></td></tr></table></figure>
<h3 id="决赛strange_lwe">[决赛]strange_lwe</h3>
<p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> my_secret_bits, flag</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.stats.distributions.discrete_gaussian_integer <span class="keyword">import</span> DiscreteGaussianDistributionIntegerSampler</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_to_list</span>(<span class="params">M</span>):</span><br><span class="line">    count = M.nrows()</span><br><span class="line">    dimension = M.ncols()</span><br><span class="line">    Matrix_list = M.<span class="built_in">list</span>()</span><br><span class="line">    M = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">        M.append(Matrix_list[i * dimension:(i+<span class="number">1</span>) * dimension])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(M) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> M[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">q = <span class="number">401</span></span><br><span class="line">m = <span class="number">64</span></span><br><span class="line">n = <span class="number">16</span></span><br><span class="line">a = <span class="number">0.025</span></span><br><span class="line">A = random_matrix(GF(q), m, n)</span><br><span class="line">t = DiscreteGaussianDistributionIntegerSampler(a*q)</span><br><span class="line">s = random_matrix(GF(q), n, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">num = <span class="number">48</span></span><br><span class="line"><span class="keyword">assert</span> flag == <span class="string">'flag{'</span> + sha1(<span class="built_in">str</span>(my_secret_bits).encode()).hexdigest() + <span class="string">'}'</span></span><br><span class="line">cipher = []</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">    <span class="keyword">if</span> my_secret_bits[j] == <span class="number">0</span>:</span><br><span class="line">        cipher.append([random_vector(GF(q), m).<span class="built_in">list</span>() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num*<span class="number">8</span>)])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        cipher.append([(A * s + Matrix([t() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(m)]).transpose()).<span class="built_in">list</span>() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num*<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line">A = matrix_to_list(A)</span><br><span class="line">data = <span class="built_in">str</span>([[<span class="built_in">int</span>(A[i][j]//<span class="number">8</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A[<span class="number">0</span>]))] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A))]) + <span class="string">'\n'</span></span><br><span class="line">data += <span class="built_in">str</span>(cipher)</span><br><span class="line"><span class="built_in">open</span>(<span class="string">'data.txt'</span>, <span class="string">'w'</span>).write(data)</span><br></pre></td></tr></table></figure>
<p>LWE问题，形如<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="18.899ex" height="2.059ex" role="img" focusable="false" viewBox="0 -716 8353.3 910"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mi" transform="translate(750,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(1441.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(2441.4,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mo" transform="translate(3185.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(4241,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mspace" transform="translate(4670,0)"></g><g data-mml-node="mi" transform="translate(5503.7,0)"><path data-c="6D" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q351 442 364 440T387 434T406 426T421 417T432 406T441 395T448 384T452 374T455 366L457 361L460 365Q463 369 466 373T475 384T488 397T503 410T523 422T546 432T572 439T603 442Q729 442 740 329Q741 322 741 190V104Q741 66 743 59T754 49Q775 46 803 46H819V0H811L788 1Q764 2 737 2T699 3Q596 3 587 0H579V46H595Q656 46 656 62Q657 64 657 200Q656 335 655 343Q649 371 635 385T611 402T585 404Q540 404 506 370Q479 343 472 315T464 232V168V108Q464 78 465 68T468 55T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z"></path><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(833,0)"></path><path data-c="64" d="M376 495Q376 511 376 535T377 568Q377 613 367 624T316 637H298V660Q298 683 300 683L310 684Q320 685 339 686T376 688Q393 689 413 690T443 693T454 694H457V390Q457 84 458 81Q461 61 472 55T517 46H535V0Q533 0 459 -5T380 -11H373V44L365 37Q307 -11 235 -11Q158 -11 96 50T34 215Q34 315 97 378T244 442Q319 442 376 393V495ZM373 342Q328 405 260 405Q211 405 173 369Q146 341 139 305T131 211Q131 155 138 120T173 59Q203 26 251 26Q322 26 373 103V342Z" transform="translate(1333,0)"></path></g><g data-mml-node="mstyle" transform="translate(7392.7,0)"><g data-mml-node="mspace"></g></g><g data-mml-node="mstyle" transform="translate(7559.7,0)"><g data-mml-node="mspace"></g></g><g data-mml-node="mi" transform="translate(7893.3,0)"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g></svg></mjx-container></span>，其中给定矩阵A和向量b，e是一个很小的误差向量，目标是求出s向量。该问题可以转化为格密码中的CVP求解问题，即求出格中的一个向量，使其距离目标向量b最近。通常可以使用<a target="_blank" rel="noopener" href="https://ctf-wiki.org/crypto/asymmetric/lattice/cvp/">babai's
nearest plane algorithm</a>算法求解。</p>
<p>直接输出误差向量来判断会发现很多bits对不上，搞了半天不太懂什么原因。但还好能算出s向量，因此绕了个弯通过s再来反求误差。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.stats.distributions.discrete_gaussian_integer <span class="keyword">import</span> DiscreteGaussianDistributionIntegerSampler</span><br><span class="line"><span class="keyword">from</span> sage.modules.free_module_integer <span class="keyword">import</span> IntegerLattice</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Babai's Nearest Plane algorithm</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Babai_closest_vector</span>(<span class="params">M, G, target</span>):</span><br><span class="line">    small = target</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(M.nrows())):</span><br><span class="line">            c = ((small * G[i]) / (G[i] * G[i])).<span class="built_in">round</span>()</span><br><span class="line">            small -=  M[i] * c</span><br><span class="line">    <span class="keyword">return</span> target - small</span><br><span class="line"></span><br><span class="line">q = <span class="number">401</span></span><br><span class="line">m = <span class="number">64</span></span><br><span class="line">n = <span class="number">16</span></span><br><span class="line">a = <span class="number">0.025</span></span><br><span class="line">num = <span class="number">48</span></span><br><span class="line">data=<span class="built_in">open</span>(<span class="string">'data.txt'</span>,<span class="string">'r'</span>).readlines()</span><br><span class="line">A=Matrix(ZZ,<span class="built_in">eval</span>(data[<span class="number">0</span>].strip()))</span><br><span class="line">cipher=<span class="built_in">eval</span>(data[<span class="number">1</span>].strip())</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(cipher))</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">#find the same s vector that output bit '1'</span></span><br><span class="line"><span class="string">res=''</span></span><br><span class="line"><span class="string">for k in range(num):</span></span><br><span class="line"><span class="string">	rt=cipher[k][0]</span></span><br><span class="line"><span class="string">	Lattice = matrix(ZZ, m + n, m)</span></span><br><span class="line"><span class="string">	for i in range(m):</span></span><br><span class="line"><span class="string">		for j in range(n):</span></span><br><span class="line"><span class="string">			Lattice[m + j, i] = A[i][j]</span></span><br><span class="line"><span class="string">		Lattice[i, i] = q</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	lattice = IntegerLattice(Lattice, lll_reduce=True)</span></span><br><span class="line"><span class="string">	print("LLL done")</span></span><br><span class="line"><span class="string">	gram = lattice.reduced_basis.gram_schmidt()[0]</span></span><br><span class="line"><span class="string">	target = vector(ZZ,rt)</span></span><br><span class="line"><span class="string">	cv = Babai_closest_vector(lattice.reduced_basis, gram, target)</span></span><br><span class="line"><span class="string">	#print("Closest Vector: {}".format(cv))</span></span><br><span class="line"><span class="string">	error=cv-target</span></span><br><span class="line"><span class="string">	print("Error: {}".format(error))</span></span><br><span class="line"><span class="string">	if any([abs(e)&gt;40 for e in error]):</span></span><br><span class="line"><span class="string">		res+='0'</span></span><br><span class="line"><span class="string">	else:</span></span><br><span class="line"><span class="string">		res+='1'</span></span><br><span class="line"><span class="string">	print(res)</span></span><br><span class="line"><span class="string">	A = matrix(Zmod(q), A)</span></span><br><span class="line"><span class="string">	try:</span></span><br><span class="line"><span class="string">		s = A.solve_right(cv)</span></span><br><span class="line"><span class="string">		print('s: {}'.format(s))</span></span><br><span class="line"><span class="string">	except:</span></span><br><span class="line"><span class="string">		print("no solution")</span></span><br><span class="line"><span class="string">		continue</span></span><br><span class="line"><span class="string">print(res)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">s=(<span class="number">195</span>, <span class="number">202</span>, <span class="number">322</span>, <span class="number">287</span>, <span class="number">230</span>, <span class="number">311</span>, <span class="number">396</span>, <span class="number">58</span>, <span class="number">242</span>, <span class="number">191</span>, <span class="number">117</span>, <span class="number">41</span>, <span class="number">248</span>, <span class="number">264</span>, <span class="number">139</span>, <span class="number">291</span>)</span><br><span class="line">s=vector(GF(q),s)</span><br><span class="line">A=Matrix(GF(q),A)</span><br><span class="line"><span class="built_in">print</span>(A*s)</span><br><span class="line">res=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">	tmp=[]</span><br><span class="line">	<span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(num*<span class="number">8</span>):</span><br><span class="line">		c=vector(ZZ,cipher[k][l])</span><br><span class="line">		As=vector(GF(q),A*s)</span><br><span class="line">		t=c-As</span><br><span class="line">		t=[tt <span class="keyword">if</span> tt&lt;(q//<span class="number">2</span>) <span class="keyword">else</span> q-tt <span class="keyword">for</span> tt <span class="keyword">in</span> t]</span><br><span class="line">		tmp.extend(t)</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">all</span>([ tt&lt;<span class="number">40</span> <span class="keyword">for</span> tt <span class="keyword">in</span> t]):</span><br><span class="line">		res+=<span class="string">'1'</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		res+=<span class="string">'0'</span></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="comment">#res='000000110110001010100111101100001101011110011110'</span></span><br><span class="line">my_secret_bits=<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,res))</span><br><span class="line">flag = <span class="string">'flag{'</span> + sha1(<span class="built_in">str</span>(my_secret_bits).encode()).hexdigest() + <span class="string">'}'</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#flag{7e0fefd15c630d4b41db2ac9e18d48d691b3d419}</span></span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>第五届美团CTF初赛&amp;决赛Crypto wp</p><p><a href="https://litao6666.github.io/202209/de508044.html">https://litao6666.github.io/202209/de508044.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><a href="https://litao6666.github.io"><p>zealot</p></a></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-09-26</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-09-29</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/202209/986c53b5.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">ByteCTF2022 Crypto wp</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/202209/ef27fca5.html"><span class="level-item">2022羊城杯Crypto wp</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="is-flex is-mobile" href="#初赛strange_rsa1"><span>[初赛]strange_rsa1</span></a></li><li><a class="is-flex is-mobile" href="#初赛strange_rsa2"><span>[初赛]strange_rsa2</span></a></li><li><a class="is-flex is-mobile" href="#决赛strange_lwe"><span>[决赛]strange_lwe</span></a></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">zealot&#039;s blog</a><p class="size-small"><span>&copy; 2023 zealot</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noreferrer">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noreferrer">Icarus</a> &amp; <a href="https://github.com/LittleYe233/hexo-theme-amazingremake" target="_blank" rel="noreferrer">Amazing-Remake</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><div class="size-small"><span>❤️Thx <strong><span id="busuanzi_value_site_uv">99+</span></strong> users <strong><span id="busuanzi_value_site_pv">99+</span></strong> visited!❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/LittleYe233/hexo-theme-amazingremake"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    enabled: true,
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/column.min.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/main.min.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { // 加载mathjax
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$']],
                    autoload: {
                        color: [],
                        colorv2: ['color']
                    },
                    packages: {'[+]': ['noerrors']}
                },
                options: {
                    ignoreHtmlClass: 'tex2jax_ignore',
                    processHtmlClass: 'tex2jax_process'
                },
                loader: {
                    load: ['input/asciimath', '[tex]/noerrors']
                }
            };
            $.getScript('//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js');
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/comment-issue-data.min.js',function(){loadIssueData('','','','',false);});
            }
            if('undefined' === 'mathjax'){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>