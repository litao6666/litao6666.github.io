<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>2022羊城杯Crypto wp - zealot&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="zealot&#039;s blog"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="zealot&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="比赛只有24h，记录一下做出来的几个题，后面太晚了实在干不动了。"><meta property="og:type" content="article"><meta property="og:title" content="2022羊城杯Crypto wp"><meta property="og:url" content="https://litao6666.github.io/202209/ef27fca5.html"><meta property="og:site_name" content="zealot&#039;s blog"><meta property="og:description" content="比赛只有24h，记录一下做出来的几个题，后面太晚了实在干不动了。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://litao6666.github.io/img/og_image.png"><meta property="article:published_time" content="2022-09-04T02:25:54.000Z"><meta property="article:modified_time" content="2022-09-04T04:05:44.391Z"><meta property="article:author" content="zealot"><meta property="article:tag" content="continued fraction"><meta property="article:tag" content="RS encode"><meta property="article:tag" content="RSA Variant"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://litao6666.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://litao6666.github.io/202209/ef27fca5.html"},"headline":"zealot's blog","image":["https://litao6666.github.io/img/og_image.png"],"datePublished":"2022-09-04T02:25:54.000Z","dateModified":"2022-09-04T04:05:44.391Z","author":{"@type":"Person","name":"zealot"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject"}},"description":"比赛只有24h，记录一下做出来的几个题，后面太晚了实在干不动了。"}</script><link rel="canonical" href="https://litao6666.github.io/202209/ef27fca5.html"><meta name="referrer" content="no-referrer"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/globalUtils.min.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/live2d/waifu.min.css"><script type="text/javascript" async src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/live2d/autoload.min.js"></script><meta name="generator" content="Hexo 6.0.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">zealot&#039;s blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/LittleYe233/hexo-theme-amazingremake"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/theme-setting.min.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-09-04  <span class="level-item"><i class="far fa-clock"> </i>16 m  <i class="fas fa-pencil-alt"> </i>2.3 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">2022羊城杯Crypto wp</h1><div class="content"><p>比赛只有24h，记录一下做出来的几个题，后面太晚了实在干不动了。</p>
<span id="more"></span>
<h3 id="easyrsa">EasyRsa</h3>
<p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">a = f.readlines()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    n = <span class="built_in">int</span>(i)</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">    m = c</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;c = %s&#x27;</span> % (m)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>output里面是一些n值，gcd一下可以发现全都有一个相同的公因子，那没啥好说的分解倒着解回来就完事儿了。</p>
<p>解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = <span class="number">38127524839835864306737280818907796566475979451567460500065967565655632622992572530918601432256137666695102199970580936307755091109351218835095309766358063857260088937006810056236871014903809290530667071255731805071115169201705265663551734892827553733293929057918850738362888383312352624299108382366714432727</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">ns = [ <span class="built_in">int</span>(line) <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines() <span class="keyword">if</span> line.strip()]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">for i in range(len(ns)):</span></span><br><span class="line"><span class="string">    for j in range(i+1,len(ns)):</span></span><br><span class="line"><span class="string">        print(GCD(ns[i],ns[j]))</span></span><br><span class="line"><span class="string">#7552850543392291177573335134779451826968284497191536051874894984844023350777357739533061306212635723884437778881981836095720474943879388731913801454095897</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">p=<span class="number">7552850543392291177573335134779451826968284497191536051874894984844023350777357739533061306212635723884437778881981836095720474943879388731913801454095897</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> ns[::-<span class="number">1</span>]:</span><br><span class="line">    q=n//p</span><br><span class="line">    d=inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    c=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(c))</span><br><span class="line"><span class="comment">#b&#x27;GWHT&#123;gixkJl7SJTcpLOL9zqwo&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="lrsa">LRSA</h3>
<p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getPQ</span>(<span class="params">p,q</span>):</span><br><span class="line">    P=getPrime(<span class="number">2048</span>)</span><br><span class="line">    Q=getPrime(<span class="number">2048</span>)</span><br><span class="line">    t=(p*P-<span class="number">58</span>*P+q)%Q</span><br><span class="line">    <span class="keyword">assert</span> (isPrime(Q))</span><br><span class="line">    <span class="keyword">return</span> P,Q,t</span><br><span class="line"></span><br><span class="line">B=getRandomNBitInteger(<span class="number">11</span>)</span><br><span class="line">p=getPrime(B)</span><br><span class="line">q=getPrime(B)</span><br><span class="line">n=p*q</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">c=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line">P,Q,t=getPQ(p,q)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;B=&quot;</span>,B)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;P*P*Q=&quot;</span>,P*P*Q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;P*Q*Q=&quot;</span>,P*Q*Q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;t=&quot;</span>,t)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c=&quot;</span>,c)</span><br></pre></td></tr></table></figure>
<p>首先可以根据提供的值求出<span class="math inline">\(P\)</span>和<span
class="math inline">\(Q\)</span>，然后我们观察到<span
class="math inline">\(t=44\)</span>非常小，因此有： <span
class="math display">\[
p*P-58*P+q\approx k*Q
\]</span> 又由于<span
class="math inline">\(q&lt;&lt;P\)</span>，因此有： <span
class="math display">\[
(p-58)*P \approx k*Q \\
\Rightarrow {\frac{P}{Q}} \approx {\frac{k}{p-58}}
\]</span> 因此对<span
class="math inline">\(\frac{P}{Q}\)</span>进行连分数展开，即可找到某一逼近的分母为<span
class="math inline">\(p-58\)</span>，从而求得<span
class="math inline">\(p\)</span>值，接着带回原式可求得<span
class="math inline">\(q\)</span>，然后解RSA即可。</p>
<p>解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"></span><br><span class="line">B=<span class="number">1023</span></span><br><span class="line">PPQ=<span class="number">17550772391048142376662352375650397168226219900284185133945819378595084615279414529115194246625188015626268312188291451580718399491413731583962229337205180301248556893326419027312533686033888462669675100382278716791450615542537581657011200868911872550652311318486382920999726120813916439522474691195194557657267042628374572411645371485995174777885120394234154274071083542059010253657420242098856699109476857347677270860654429688935924519805555787949683144015873225388396740487817155358042797286990338440987035608851331840925854381286767024584195081004360635842976624747610461507795755042915965483135990495921912997789567020652729777216671481467049291624343256152446367091568361258918212012737611001009003078023715854575413979603297947011959023398306612437250872299406744778763429172689675430968886613391356192380152315042387148665654062576525633130546454743040442444227245763939134967515614637300940642555367668537324892890004459521919887178391559206373513466653484926149453481758790663522317898916616435463486824881406198956479504970446076256447830689197409184703931842169195650953917594642601134810084247402051464584676932882503143409428970896718980446185114397748313655630266379123438583315809104543663538494519415242569480492899140190587129956835218417371308642212037424611690324353109931657289337536406499314388951678319136343913551598851601805737870217800009086551022197432448461112330252097447894028786035069710260561955740514091976513928307284531381150606428802334767412638213776730300093872457594524254858721551285338651364457529927871215183857169772407595348187949014442596356406144157105062291018215254440382214000573515515859668018846789551567310531570458316720877172632139481792680258388798439064221051325274383331521717987420093245521230610073103811158660291643007279940393509663374960353315388446956868294358252276964954745551655711981</span></span><br><span class="line">PQQ=<span class="number">17632503734712698604217167790453868045296303200715867263641257955056721075502316035280716025016839471684329988600978978424661087892466132185482035374940487837109552684763339574491378951189521258328752145077889261805000262141719400516584216130899437363088936913664419705248701787497332582188063869114908628807937049986360525010012039863210179017248132893824655341728382780250878156526086594253092249935304259986328308203344932540888448163430113818706295806406535364433801544858874357459282988110371175948011077595778123265914357153104206808258347815853145593128831233094769191889153762451880396333921190835200889266000562699392602082643298040136498839726733129090381507278582253125509943696419087708429546384313035073010683709744463087794325058122495375333875728593383803489271258323466068830034394348582326189840226236821974979834541554188673335151333713605570214286605391522582123096490317734786072061052604324131559447145448500381240146742679889154145555389449773359530020107821711994953950072547113428811855524572017820861579995449831880269151834230607863568992929328355995768974532894288752369127771516710199600449849031992434777962666440682129817924824151147427747882725858977273856311911431085373396551436319200582072164015150896425482384248479071434032953021738952688256364397405939276917210952583838731888536160866721278250628482428975748118973182256529453045184370543766401320261730361611365906347736001225775255350554164449014831203472238042057456969218316231699556466298168668958678855382462970622819417830000343573014265235688391542452769592096406400900187933156352226983897249981036555748543606676736274049188713348408983072484516372145496924391146241282884948724825393087105077360952770212959517318021248639012476095670769959011548699960423508352158455979906789927951812368185987838359200354730654103428077770839008773864604836807261909</span></span><br><span class="line">t=<span class="number">44</span></span><br><span class="line">c=<span class="number">4364802217291010807437827526073499188746160856656033054696031258814848127341094853323797303333741617649819892633013549917144139975939225893749114460910089509552261297408649636515368831194227006310835137628421405558641056278574098849091436284763725120659865442243245486345692476515256604820175726649516152356765363753262839864657243662645981385763738120585801720865252694204286145009527172990713740098977714337038793323846801300955225503801654258983911473974238212956519721447805792992654110642511482243273775873164502478594971816554268730722314333969932527553109979814408613177186842539860073028659812891580301154746</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">simplify_fraction</span>(<span class="params">e,n,max_size</span>):</span><br><span class="line">    <span class="keyword">assert</span> e&lt;n</span><br><span class="line">    simp_list=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(max_size):</span><br><span class="line">        <span class="keyword">if</span> e==<span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        t=n//e</span><br><span class="line">        simp_list.append(t)</span><br><span class="line">        (e,n)=(n-e*t,e)</span><br><span class="line">    <span class="keyword">return</span> simp_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calc_convergent</span>(<span class="params">simp</span>):</span><br><span class="line">    convergent=[(<span class="number">0</span>,<span class="number">0</span>)]*<span class="built_in">len</span>(simp)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(simp)):</span><br><span class="line">        a,b=<span class="number">1</span>,simp[i]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">            a,b=b,simp[i-<span class="number">1</span>-j]*b+a</span><br><span class="line">        convergent[i]=(a,b)</span><br><span class="line">    <span class="keyword">return</span> convergent</span><br><span class="line"></span><br><span class="line">PQ,b=iroot(PPQ*PQQ,<span class="number">3</span>)</span><br><span class="line"><span class="keyword">assert</span> b</span><br><span class="line">P=PPQ//PQ</span><br><span class="line">Q=PQQ//PQ</span><br><span class="line">simp=simplify_fraction(P,Q,<span class="number">1000</span>)</span><br><span class="line">convergent=calc_convergent(simp)</span><br><span class="line"><span class="keyword">for</span> a,b <span class="keyword">in</span> convergent:</span><br><span class="line">    <span class="keyword">if</span> isPrime(b+<span class="number">58</span>) <span class="keyword">and</span> b.bit_length()==<span class="number">1023</span>:</span><br><span class="line">        p=b+<span class="number">58</span></span><br><span class="line">        q=(t-p*P+<span class="number">58</span>*P)%Q</span><br><span class="line">        <span class="keyword">assert</span> isPrime(q)</span><br><span class="line">        n=p*q</span><br><span class="line">        d=inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">        m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line"><span class="comment">#b&#x27;DASCTF&#123;8f3djoj9wedj2_dkc903cwckckdk&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="solomens-puzzle-1">Solomen's puzzle 1</h3>
<p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># type: ignore</span></span><br><span class="line"></span><br><span class="line">m = <span class="number">257</span></span><br><span class="line">F = Zmod(m)</span><br><span class="line">alpha = F(<span class="number">223</span>)</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(F)</span><br><span class="line">gx = (x - alpha ^ <span class="number">0</span>) * (x - alpha ^ <span class="number">1</span>) * (x - alpha ^ <span class="number">2</span>) * (x - alpha ^ <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_block</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(message, <span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">    f = PR([<span class="number">0</span>] * <span class="number">4</span> + message)</span><br><span class="line">    px = f % gx</span><br><span class="line">    mx = f - px</span><br><span class="line">    c = [_ <span class="keyword">for</span> _ <span class="keyword">in</span> mx]</span><br><span class="line">    <span class="keyword">return</span> c + (<span class="number">8</span> - <span class="built_in">len</span>(c)) * [<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">byte_stream</span>):</span><br><span class="line"></span><br><span class="line">    length = <span class="built_in">len</span>(byte_stream)</span><br><span class="line">    <span class="keyword">if</span> length % <span class="number">4</span> != <span class="number">0</span>:</span><br><span class="line">        padding = (length // <span class="number">4</span> + <span class="number">1</span>) * <span class="number">4</span> - length</span><br><span class="line">        byte_stream += padding * <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">        length += padding</span><br><span class="line">    code = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, length, <span class="number">4</span>):</span><br><span class="line">        block = byte_stream[i:i+<span class="number">4</span>]</span><br><span class="line">        block_code = encode_block([each <span class="keyword">for</span> each <span class="keyword">in</span> block])</span><br><span class="line">        code += <span class="built_in">bytes</span>(block_code)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, p, q</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"></span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">10632528934906371807995216845027219767890923967559690651733628659750564299493611010425615580946665632019547006685100876646048602773295571936276450835367591</span></span><br><span class="line"></span><br><span class="line">cipher = bytes_to_long(flag) * e % n</span><br><span class="line">code = encode(long_to_bytes(cipher))</span><br><span class="line"></span><br><span class="line">code = [each <span class="keyword">for</span> each <span class="keyword">in</span> code]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>, <span class="number">8</span>):</span><br><span class="line">    index1 = randrange(<span class="number">4</span>, <span class="number">8</span>)</span><br><span class="line">    value1 = randrange(<span class="number">0</span>, <span class="number">256</span>)</span><br><span class="line">    index2 = randrange(<span class="number">4</span>, <span class="number">8</span>)</span><br><span class="line">    value2 = randrange(<span class="number">0</span>, <span class="number">256</span>)</span><br><span class="line">    code[i + index1] = value1</span><br><span class="line">    code[i + index2] = value2</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(code))</span><br></pre></td></tr></table></figure>
<p>从题目名也可以看出来，本题的考点是Reed-Solomon纠错编码，这是一种基于有限域内多项式运算的纠错码。具体原理可以参考<a
target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Reed%E2%80%93Solomon_error_correction">wiki</a>上的解释，看不懂英文的也可以去<a
target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/104306038">这篇文章</a>上看看，讲的也很清楚。</p>
<p>在本题中，每个消息块消息长度为4，纠错码长度为4，组成8字节的编码。根据RS纠错码原理，长度为4的纠错码最多能纠正的错误为<span
class="math inline">\(4/2=2\)</span>个。而本题也是在编码的消息部分随机产生了1~2字节的错误，因此纠错码是完全能够将错误全部纠正，得到正确的消息。</p>
<p>因此，本题主要考察的是如何根据编码进行纠错的问题。这一问题在以上的两份链接中也有相关的算法描述（其实是懒得贴公式）。先计算编码的syndrome值，然后根据syndrome值计算得到一个error
locator向量，从而可以算出发生error的位置，最后代入到error
locator多项式可以求出error value。</p>
<p>注意到编码中错误的个数是不确定的，我直接枚举了。</p>
<p>解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">enc=<span class="string">b&#x27;\xb9$5.&gt;\xff\xe3S\xc91\xb2\xeb\x1byR(\x12&#123;\xc4\xbf\xa4wo|\xc5-;\xc9\xc9S[\xaeX\xad\xf0\xef@\x1c\x87]\x9a\xb9:\x8cu\xa5\xe3EA&lt;&quot;\xfd\x9a\xbfqB\x94\xc3R\x95\xd5\xbd\xd0\x10u\x10\xe3\xa5&quot;S\xed\xd0\xf8\x02\xbf\x124A~1]\xceP\xdf\xf2Cr1\x93\xacw\x03\tQe\xcc2b\xbf\x0f\x92\xad\x19\x00\xab|\xf3\xc9\x9b&amp;I%\xf5\x9b#\xf7\xa2\xcb\xb1\x0c\xee\xb56\xd5\xd2\xd5[?^\x9d\x8b\x93\xbe\x832\xee\xa9\xa5\x83$\xe9\xe5\x95\x01\xd6\x9f\xad\x1f\x90\xc3]aL\x10\x07&#123;#4i^\xae\xdf|\x9f\x94\xf4\xaf\x06R\x86j&amp;\xeb\x0b\x06\xcf\xb2\x8e\xb4\xb9s\x97[\xf1ip\x06\xf8\xfdFs\xf1`\xc6\x82\xd8\xce\xf6\x95&#123;\xe3\x8cQ\xed\xef\xe9\xb9\&#x27;\x19\xdf^\xc8\x81\xde\x1fQ\x1e\x86\xda\xf8\xfd4M0#\xef\x8a\xe9\xe5\xfc\xe2\xe3\xe6\xd0e\xce\xe1\x0b\x9eM\x07\xc2Y\xf8B\xe1\xde\xfaP\xe9\x9d\xde\xc3\xe3C\xa5&#x27;</span></span><br><span class="line">e = <span class="number">10632528934906371807995216845027219767890923967559690651733628659750564299493611010425615580946665632019547006685100876646048602773295571936276450835367591</span></span><br><span class="line">n = <span class="number">94257413713770111563970534929325680923943690882102478219183863722026590313165304301118258536360712467357451726680293716779730218553691126214750969333228034756948476572806064756873382054384808713137658321644158757777088916851366208046581218865015163572359836440643828462291397248680038931998325006839692797347</span></span><br><span class="line">m = <span class="number">257</span></span><br><span class="line">F = Zmod(m)</span><br><span class="line">alpha = F(<span class="number">223</span>)</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(F)</span><br><span class="line">gx = (x - alpha ^ <span class="number">0</span>) * (x - alpha ^ <span class="number">1</span>) * (x - alpha ^ <span class="number">2</span>) * (x - alpha ^ <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_syndromes</span>(<span class="params">mx</span>):</span><br><span class="line">    <span class="keyword">return</span> [mx(alpha^i)<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_locator</span>(<span class="params">synd,v</span>):</span><br><span class="line">	<span class="keyword">if</span> v==<span class="number">2</span>:</span><br><span class="line">		m=Matrix([[synd[<span class="number">0</span>],synd[<span class="number">1</span>]],[synd[<span class="number">1</span>],synd[<span class="number">2</span>]]])</span><br><span class="line">		vec=vector([-synd[<span class="number">2</span>],-synd[<span class="number">3</span>]])</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">list</span>(m^-<span class="number">1</span>*vec)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> F((-synd[<span class="number">1</span>])*synd[<span class="number">0</span>]^-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pos</span>(<span class="params">loc,v</span>):</span><br><span class="line">	<span class="keyword">if</span> v==<span class="number">2</span>:</span><br><span class="line">		pos=[]</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">			xx=alpha^(-i)</span><br><span class="line">			<span class="keyword">if</span> F(<span class="number">1</span>+loc[<span class="number">1</span>]*xx+loc[<span class="number">0</span>]*xx^<span class="number">2</span>)==<span class="number">0</span>:</span><br><span class="line">				pos.append(i)</span><br><span class="line">		<span class="keyword">return</span> [ alpha^i <span class="keyword">for</span> i <span class="keyword">in</span> pos]</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		res=F(-loc^-<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">return</span> [F(res^-<span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_err_val</span>(<span class="params">synd,pos,v</span>):</span><br><span class="line">	<span class="keyword">if</span> v==<span class="number">2</span>:</span><br><span class="line">		m=Matrix(F,[[pos[<span class="number">0</span>]^<span class="number">0</span>,pos[<span class="number">1</span>]^<span class="number">0</span>],[pos[<span class="number">0</span>]^<span class="number">1</span>,pos[<span class="number">1</span>]^<span class="number">1</span>]])</span><br><span class="line">		v=vector([synd[<span class="number">0</span>],synd[<span class="number">1</span>]])</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">list</span>(m^-<span class="number">1</span>*v)	</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> [F(synd[<span class="number">0</span>])]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_block</span>(<span class="params">block</span>):</span><br><span class="line">	mx=PR(<span class="built_in">list</span>(block))</span><br><span class="line">	synd=get_syndromes(mx)</span><br><span class="line">	<span class="keyword">for</span> v <span class="keyword">in</span> [<span class="number">2</span>,<span class="number">1</span>]:		</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			locator=get_locator(synd,v)</span><br><span class="line">			pos=get_pos(locator,v)</span><br><span class="line">			arr=[alpha^i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line">			err_idx=[ arr.index(t) <span class="keyword">for</span> t <span class="keyword">in</span> pos]</span><br><span class="line">			err_val=get_err_val(synd,pos,v)</span><br><span class="line">			err=[<span class="number">0</span>]*<span class="number">8</span></span><br><span class="line">			<span class="keyword">for</span> val,i <span class="keyword">in</span> <span class="built_in">zip</span>(err_val,err_idx):</span><br><span class="line">				err[i]=val</span><br><span class="line">			plain=mx-PR(err)</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">bytes</span>(<span class="built_in">list</span>(plain))[<span class="number">4</span>:<span class="number">8</span>]</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">			<span class="comment">#print(e)</span></span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">enc</span>):</span><br><span class="line">	plain=<span class="string">b&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(enc),<span class="number">8</span>):</span><br><span class="line">		block=enc[i:i+<span class="number">8</span>]</span><br><span class="line">		plain+=decode_block(block)</span><br><span class="line">	<span class="keyword">return</span> plain</span><br><span class="line"></span><br><span class="line">dec=decode(enc)</span><br><span class="line">flag=bytes_to_long(dec)*inverse(e,n)%n</span><br><span class="line">flag=long_to_bytes(flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line">flag=<span class="string">&#x27;DASCTF&#123;%s&#125;&#x27;</span>%md5(flag).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#b&#x27;DASCTF&#123;What_a_funny_rsa_question_posted_by_Reed_and_Solomen_LOL_HHHHHH&#125;&#x27;</span></span><br><span class="line"><span class="comment">#DASCTF&#123;4e4fc02d88b0c8f66c924489e1bf58ea&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="novelsystem2">NovelSystem2</h3>
<p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> uuid4</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NovelSystem</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, delta</span>):</span><br><span class="line">        self.p = getPrime(delta &gt;&gt; <span class="number">1</span>)</span><br><span class="line">        self.q = getPrime(delta &gt;&gt; <span class="number">1</span>)</span><br><span class="line">        self.N = self.p * self.q</span><br><span class="line">        </span><br><span class="line">        self.beta = <span class="number">0.397</span></span><br><span class="line">        self.psi = (self.p ** <span class="number">2</span> + self.p + <span class="number">1</span>) * (self.q ** <span class="number">2</span> + self.q + <span class="number">1</span>)</span><br><span class="line">        self.e, self.d = self.generate_key(delta)</span><br><span class="line">        self.r = getPrime(delta % delta.bit_length())</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate_key</span>(<span class="params">self, delta</span>):</span><br><span class="line">        delta = <span class="built_in">int</span>(delta * self.beta)</span><br><span class="line">        d = getPrime(delta)</span><br><span class="line">        e = invert(d, self.psi)</span><br><span class="line">        <span class="keyword">return</span> (e, d)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">print_pk</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;pk:&quot;</span>, (self.N, <span class="built_in">int</span>(self.e), self.r))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">print_sk</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;sk:&quot;</span>, (self.N, self.p, self.q, self.e, self.d))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        m, n = a</span><br><span class="line">        k, l = b</span><br><span class="line">        <span class="keyword">if</span> a[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">            a, b = b, a</span><br><span class="line">            m, n, k, l = k, l, m, n</span><br><span class="line">        <span class="keyword">if</span> l == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> (m * k, m + k)</span><br><span class="line">            <span class="keyword">if</span> (n + k) % self.N == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> (m - n ** <span class="number">2</span>) % self.N == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> ((m * k + self.r) * invert(m - n * n) % self.N, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> ((m * k + self.r) * invert(n + k, self.N) % self.N, (m + n * k) * invert(n + k,self.N) % self.N)</span><br><span class="line">        <span class="keyword">if</span> (m + k + n * l) % self.N != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> ((m * k + (n + l) * self.r) * invert(m + k + n * l, self.N)%self.N,(n * k + m * l + self.r) * invert(m + k + n * l, self.N) % self.N)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (n * k + m * l + self.r) % self.N == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> ((m * k + (n + l) * self.r) * invert(n * k + m * l + self.r, self.N) % self.N, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul_</span>(<span class="params">self, a, n</span>):</span><br><span class="line">        ans = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">                ans = self.add_(ans, a)</span><br><span class="line">            a = self.add_(a, a)</span><br><span class="line">            n //= <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, m</span>):</span><br><span class="line">        <span class="keyword">return</span> self.mul_(m, self.e)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, c</span>):</span><br><span class="line">        <span class="keyword">return</span> self.mul_(c, self.d)</span><br><span class="line"></span><br><span class="line">delta = <span class="number">1024</span></span><br><span class="line">enc = NovelSystem(delta)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag[:<span class="built_in">len</span>(flag) // <span class="number">2</span>]), bytes_to_long(flag[<span class="built_in">len</span>(flag) // <span class="number">2</span>:])</span><br><span class="line">c = enc.encrypt(m)</span><br><span class="line">enc.print_pk()</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="keyword">assert</span> enc.decrypt(c) == m</span><br></pre></td></tr></table></figure>
<p>这题是RSA的一种变种，其中的phi变成了<span
class="math inline">\((p^2+p+1)*(q^2+q+1)\)</span>。</p>
<p>经过一番搜索发现，该系统是Murru and
Saettone提出的一种新的类RSA加密系统。其方案<a
target="_blank" rel="noopener" href="https://iris.unito.it/bitstream/2318/1669371/1/crypto-cubic-pell-v4.pdf">原文链接</a>在此。然而，这一RSA变体形式仍然可以被传统的Boneh
and Durfee等攻击手法攻击。攻击方案在<a
target="_blank" rel="noopener" href="https://eprint.iacr.org/2021/1160.pdf">这篇论文</a>中有详细的描述。文中分析到，只要满足<span
class="math inline">\(d&lt;N^{0.5694}\)</span>，就可以利用 small inverse
problem对<span
class="math inline">\(N\)</span>进行多项式时间内分解。</p>
<p>本来尝试手动写一下攻击的实现，结果无意间找到原题了，原题是[pbCTF
2021]Yet Another RSA，连参数都没怎么改，好家伙！</p>
<p>解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"></span><br><span class="line">e=<span class="number">3569709831456961963983317856906282564247794656174883346551318455409781951821532194464316039706968856000098892463123452801581913760419867217744612993876726508565953876218527986879338419527071132882516845467078252901861510834762733680624403662683842157212966883670782784707420186939792539380416673702618954148609178781352393489552193742869735649479707631323667621294737562886946346783459713562739324444015141587968954791790724386091523034752910330271202144122827876441229219899077622471534860855412052877175120218922873300885113936346989198403927493848984768217738562507350427274074810257890679068944519650350540061773</span></span><br><span class="line">N=<span class="number">69608791192421919283757675475568920773353852553984294535246714322217147926140334786382671447161809319059757926660104907264892471513691210713164936055575369238706600340586833164515933300246888063235136692968128246137215938114060492757345025435557818940819819146315427528432401269318798897677955790143951114837</span></span><br><span class="line"></span><br><span class="line">P.&lt;x, y&gt; = PolynomialRing(ZZ)</span><br><span class="line"></span><br><span class="line">m = <span class="number">4</span></span><br><span class="line">t = <span class="number">2</span></span><br><span class="line">X = <span class="built_in">int</span>(N ^ <span class="number">0.4</span>)</span><br><span class="line">Y = <span class="number">3</span> * <span class="built_in">int</span>(N ^ <span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">a = N + <span class="number">1</span></span><br><span class="line">b = N^<span class="number">2</span> - N + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">f = x * (y^<span class="number">2</span> + a * y + b) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">gs = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k, m + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> * k, <span class="number">2</span> * k + <span class="number">2</span>):</span><br><span class="line">            g = x^(i - k) * y^(j - <span class="number">2</span> * k) * f^k * e^(m - k)</span><br><span class="line">            gs.append((i, j, k, g))</span><br><span class="line">    i = k</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> * k + <span class="number">2</span>, <span class="number">2</span> * k + t + <span class="number">1</span>):</span><br><span class="line">        g = x^(i - k) * y^(j - <span class="number">2</span> * k) * f^k * e^(m - k)    </span><br><span class="line">        gs.append((i, j, k, g))</span><br><span class="line"></span><br><span class="line">gs.sort()</span><br><span class="line"></span><br><span class="line">monomials = []</span><br><span class="line"><span class="keyword">for</span> tup <span class="keyword">in</span> gs:</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> tup[-<span class="number">1</span>].monomials():</span><br><span class="line">        <span class="keyword">if</span> v <span class="keyword">not</span> <span class="keyword">in</span> monomials:</span><br><span class="line">            monomials.append(v)</span><br><span class="line"></span><br><span class="line">mat = [[<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(monomials))] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(gs))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, tup <span class="keyword">in</span> <span class="built_in">enumerate</span>(gs):</span><br><span class="line">    <span class="keyword">for</span> j, mono <span class="keyword">in</span> <span class="built_in">enumerate</span>(monomials):</span><br><span class="line">        mat[i][j] = tup[-<span class="number">1</span>].monomial_coefficient(mono) * mono(X, Y)</span><br><span class="line"></span><br><span class="line">mat = Matrix(ZZ, mat)</span><br><span class="line">mat = mat.LLL()</span><br><span class="line"></span><br><span class="line">pols = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(gs)):</span><br><span class="line">    f = <span class="built_in">sum</span>(mat[i, k] * monomials[k] / monomials[k](X, Y) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(monomials)))</span><br><span class="line">    pols.append(f)</span><br><span class="line"></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(gs)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="built_in">len</span>(gs)):</span><br><span class="line">        f1, f2 = pols[i], pols[j]</span><br><span class="line"></span><br><span class="line">        rr = f1.resultant(f2)</span><br><span class="line">        <span class="keyword">if</span> rr.is_zero() <span class="keyword">or</span> rr.monomials() == [<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                PR.&lt;q&gt; = PolynomialRing(ZZ)</span><br><span class="line">                rr = rr(q, q)</span><br><span class="line">                soly = <span class="built_in">int</span>(rr.roots()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">                ss = f1(q, soly)</span><br><span class="line">                solx = <span class="built_in">int</span>(ss.roots()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">                <span class="built_in">print</span>(i, j)</span><br><span class="line">                <span class="built_in">print</span>(solx, soly)</span><br><span class="line">                <span class="keyword">assert</span> f1(solx, soly) == <span class="number">0</span></span><br><span class="line">                <span class="keyword">assert</span> f2(solx, soly) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">                found = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">if</span> found:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> found:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">b, c = soly, N</span><br><span class="line">Dsqrt = <span class="built_in">int</span>(sqrt(b^<span class="number">2</span> - <span class="number">4</span>*c))</span><br><span class="line">p, q = (b + Dsqrt) // <span class="number">2</span>, (b - Dsqrt) // <span class="number">2</span></span><br><span class="line"><span class="keyword">assert</span> p * q == N</span><br><span class="line"></span><br><span class="line">phi = (p**<span class="number">2</span> + p + <span class="number">1</span>) * (q**<span class="number">2</span> + q + <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NovelSystem</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, p, q, e, d</span>):</span><br><span class="line">        self.p = p</span><br><span class="line">        self.q = q</span><br><span class="line">        self.N = self.p * self.q</span><br><span class="line">        </span><br><span class="line">        self.beta = <span class="number">0.397</span></span><br><span class="line">        self.psi = (self.p ** <span class="number">2</span> + self.p + <span class="number">1</span>) * (self.q ** <span class="number">2</span> + self.q + <span class="number">1</span>)</span><br><span class="line">        self.e, self.d = e, d</span><br><span class="line">        self.r = <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        m, n = a</span><br><span class="line">        k, l = b</span><br><span class="line">        <span class="keyword">if</span> a[<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">            a, b = b, a</span><br><span class="line">            m, n, k, l = k, l, m, n</span><br><span class="line">        <span class="keyword">if</span> l == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> (m * k, m + k)</span><br><span class="line">            <span class="keyword">if</span> (n + k) % self.N == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> (m - n ** <span class="number">2</span>) % self.N == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> ((m * k + self.r) * invert(m - n * n) % self.N, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> ((m * k + self.r) * invert(n + k, self.N) % self.N, (m + n * k) * invert(n + k,self.N) % self.N)</span><br><span class="line">        <span class="keyword">if</span> (m + k + n * l) % self.N != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> ((m * k + (n + l) * self.r) * invert(m + k + n * l, self.N)%self.N,(n * k + m * l + self.r) * invert(m + k + n * l, self.N) % self.N)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (n * k + m * l + self.r) % self.N == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> ((m * k + (n + l) * self.r) * invert(n * k + m * l + self.r, self.N) % self.N, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul_</span>(<span class="params">self, a, n</span>):</span><br><span class="line">        ans = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">                ans = self.add_(ans, a)</span><br><span class="line">            a = self.add_(a, a)</span><br><span class="line">            n //= <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, m</span>):</span><br><span class="line">        <span class="keyword">return</span> self.mul_(m, self.e)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, c</span>):</span><br><span class="line">        <span class="keyword">return</span> self.mul_(c, self.d)</span><br><span class="line"></span><br><span class="line">c = (<span class="number">25277872308079622747549210576460613586229133947234593535200353386990766871354231190884983744062724190757790170095336476433339679661865115249940491581950905446714526508336734968117122923367321009658430492676221613955154012709104353264746945809594342072744903918483080444098810305069478604650812993367066108686</span>, <span class="number">23837611977059204694294310415628596206205358541193793076161113947121055317488611201828968875769165810136018932772918536959013421962176622562932517080185242296377551991015543007194938521921909070483342042300905806379510158998331097627686209024554054114596970966269941945120227200103961459438854583220408434182</span>)</span><br><span class="line">enc = NovelSystem(p,q,e,d)</span><br><span class="line">m = enc.decrypt(c)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m[<span class="number">0</span>]) + long_to_bytes(m[<span class="number">1</span>]))</span><br><span class="line"><span class="comment">#b&#x27;DASCTF&#123;a1a4a518320a469088c64aa4fbc22438&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>2022羊城杯Crypto wp</p><p><a href="https://litao6666.github.io/202209/ef27fca5.html">https://litao6666.github.io/202209/ef27fca5.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><a href="https://litao6666.github.io"><p>zealot</p></a></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-09-04</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-09-04</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/202209/de508044.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">第五届美团CTF初赛&amp;决赛Crypto wp</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/202208/ebfe4390.html"><span class="level-item">WMCTF2022 Crypto wp</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="is-flex is-mobile" href="#easyrsa"><span>EasyRsa</span></a></li><li><a class="is-flex is-mobile" href="#lrsa"><span>LRSA</span></a></li><li><a class="is-flex is-mobile" href="#solomens-puzzle-1"><span>Solomen&#039;s puzzle 1</span></a></li><li><a class="is-flex is-mobile" href="#novelsystem2"><span>NovelSystem2</span></a></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">zealot&#039;s blog</a><p class="size-small"><span>&copy; 2023 zealot</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noreferrer">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noreferrer">Icarus</a> &amp; <a href="https://github.com/LittleYe233/hexo-theme-amazingremake" target="_blank" rel="noreferrer">Amazing-Remake</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><div class="size-small"><span>❤️Thx <strong><span id="busuanzi_value_site_uv">99+</span></strong> users <strong><span id="busuanzi_value_site_pv">99+</span></strong> visited!❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/LittleYe233/hexo-theme-amazingremake"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    enabled: true,
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/column.min.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/main.min.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { // 加载mathjax
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$']],
                    autoload: {
                        color: [],
                        colorv2: ['color']
                    },
                    packages: {'[+]': ['noerrors']}
                },
                options: {
                    ignoreHtmlClass: 'tex2jax_ignore',
                    processHtmlClass: 'tex2jax_process'
                },
                loader: {
                    load: ['input/asciimath', '[tex]/noerrors']
                }
            };
            $.getScript('//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js');
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/comment-issue-data.min.js',function(){loadIssueData('','','','',false);});
            }
            if('undefined' === 'mathjax'){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>