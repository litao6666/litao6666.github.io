<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>WMCTF2022 Crypto wp - zealot&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="zealot&#039;s blog"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="zealot&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="两天的WMCTF，整个做下来感觉密码题出得确实蛮好的，很值得学习与复现。在比赛中也能收获很多知识。很棒！明年还来~"><meta property="og:type" content="article"><meta property="og:title" content="WMCTF2022 Crypto wp"><meta property="og:url" content="https://litao6666.github.io/202208/ebfe4390.html"><meta property="og:site_name" content="zealot&#039;s blog"><meta property="og:description" content="两天的WMCTF，整个做下来感觉密码题出得确实蛮好的，很值得学习与复现。在比赛中也能收获很多知识。很棒！明年还来~"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://litao6666.github.io/img/og_image.png"><meta property="article:published_time" content="2022-08-22T04:01:37.000Z"><meta property="article:modified_time" content="2022-08-27T03:04:44.335Z"><meta property="article:author" content="zealot"><meta property="article:tag" content="ecc"><meta property="article:tag" content="lattice"><meta property="article:tag" content="FHE"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://litao6666.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://litao6666.github.io/202208/ebfe4390.html"},"headline":"zealot's blog","image":["https://litao6666.github.io/img/og_image.png"],"datePublished":"2022-08-22T04:01:37.000Z","dateModified":"2022-08-27T03:04:44.335Z","author":{"@type":"Person","name":"zealot"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject"}},"description":"两天的WMCTF，整个做下来感觉密码题出得确实蛮好的，很值得学习与复现。在比赛中也能收获很多知识。很棒！明年还来~"}</script><link rel="canonical" href="https://litao6666.github.io/202208/ebfe4390.html"><meta name="referrer" content="no-referrer"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/globalUtils.min.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/live2d/waifu.min.css"><script type="text/javascript" async src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/live2d/autoload.min.js"></script><meta name="generator" content="Hexo 6.0.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">zealot&#039;s blog</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/LittleYe233/hexo-theme-amazingremake"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/theme-setting.min.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2022-08-22  <span class="level-item"><i class="far fa-clock"> </i>25 m  <i class="fas fa-pencil-alt"> </i>3.8 k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visits</span></div></div><h1 class="title is-3 is-size-4-mobile">WMCTF2022 Crypto wp</h1><div class="content"><p>两天的WMCTF，整个做下来感觉密码题出得确实蛮好的，很值得学习与复现。在比赛中也能收获很多知识。很棒！明年还来~</p>
<span id="more"></span>
<p>先记录一下解出的题目。ocb磕了一下午没磕出来，就等wp吧（应该会有吧~）。</p>
<h3 id="ecc">ecc</h3>
<p>题目没有给源码，只给了输出文本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">flag bits: 606</span><br><span class="line">e = 0x10001</span><br><span class="line">n = 61262574892917665379101848600282751252633178779864648655116434051615964747592676204833262666589440081296571836666022795166255640192795587508845265816642144669301520989571990670507103278098950563219296310830719975959589061794360407053224254135937766317251283933110936269282950512402428088733821277056712795259</span><br><span class="line">c = 16002162436420434728223131316901476099110904029045408221515087977802746863468505266500673611412375885221860212238712311981079623398373906773247773552766200431323537510699147642358473715224124662007742017000810447999989426207919068340364725395075614636875116086496704959130761547095168937180751237132642548997</span><br><span class="line">G = (3364552845709696244757995625685399274809023621531082895612949981433844727622567352338990765970534554565693355095508508160162961299445890209860508127449468 : 4874111773041360858453223185020051270111929505293131058858547656851279111764112235653823943997681930204977283843433850957234770591933663960666437259499093 : 1)</span><br><span class="line">3G = (8240596254289477251157504980772167439041663401504657696787046343848644902166655624353107697436635678388969190302189718026343959470011854412337179727187240 : 4413479999185843948404442728411950785256136111461847698098967018173326770728464491960875264034301169184074110521039566669441716138955932362724194843596479 : 1)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>根据常识可以知道，这里包含了RSA参数和ECC上<span
class="math inline">\(G\)</span>和<span
class="math inline">\(3G\)</span>两个点。这套路岂不是和前段时间的<a
href="https://litao6666.github.io/202208/77a08f09.html#corctf-2022-threetreasures">corCTF-threetreasures</a>很相似，RSA和ECC共用同一个因子<span
class="math inline">\(p\)</span>。猜测本题也是把flag分成三块。因此需要根据ECC上两个点的信息求出ECC的参数，然后分解<span
class="math inline">\(n\)</span>来解RSA。</p>
<p>我们有ECC上两个点的坐标，因此根据ECC方程<span
class="math inline">\(y^2=x^3+ax+b\mod
p\)</span>可以得到两个方程来求出<span
class="math inline">\(a\)</span>和<span
class="math inline">\(b\)</span>。由于这里与threetreasures题目有一定区别，无法针对<span
class="math inline">\(a\)</span>的高位使用coppersmith攻击，但是我们还可以利用<span
class="math inline">\(G\)</span>和<span
class="math inline">\(3G\)</span>两个点之间的关系。</p>
<p>具体来讲，我们先用两个点的坐标得到两个多项式，然后可以先在模<span
class="math inline">\(n\)</span>的意义下求出<span
class="math inline">\(a\)</span>和<span
class="math inline">\(b\)</span>，然后利用ECC点乘计算公式得到两点坐标之间的关系，而给的坐标是模<span
class="math inline">\(p\)</span>意义下的，从而可以与<span
class="math inline">\(n\)</span>做gcd从而分解出<span
class="math inline">\(p\)</span>。然后常规解RSA，同时求出<span
class="math inline">\(a\)</span>和<span
class="math inline">\(b\)</span>模<span
class="math inline">\(p\)</span>的值即可。</p>
<p>解题脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.matrix.matrix2 <span class="keyword">import</span> Matrix</span><br><span class="line"></span><br><span class="line">flag_bits=<span class="number">606</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = <span class="number">61262574892917665379101848600282751252633178779864648655116434051615964747592676204833262666589440081296571836666022795166255640192795587508845265816642144669301520989571990670507103278098950563219296310830719975959589061794360407053224254135937766317251283933110936269282950512402428088733821277056712795259</span></span><br><span class="line">c = <span class="number">16002162436420434728223131316901476099110904029045408221515087977802746863468505266500673611412375885221860212238712311981079623398373906773247773552766200431323537510699147642358473715224124662007742017000810447999989426207919068340364725395075614636875116086496704959130761547095168937180751237132642548997</span></span><br><span class="line">Gx,Gy = (<span class="number">3364552845709696244757995625685399274809023621531082895612949981433844727622567352338990765970534554565693355095508508160162961299445890209860508127449468</span> , <span class="number">4874111773041360858453223185020051270111929505293131058858547656851279111764112235653823943997681930204977283843433850957234770591933663960666437259499093</span> )</span><br><span class="line">G3x,G3y = (<span class="number">8240596254289477251157504980772167439041663401504657696787046343848644902166655624353107697436635678388969190302189718026343959470011854412337179727187240</span> , <span class="number">4413479999185843948404442728411950785256136111461847698098967018173326770728464491960875264034301169184074110521039566669441716138955932362724194843596479</span> )</span><br><span class="line"></span><br><span class="line">R.&lt;a,b&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">I=[]</span><br><span class="line">I.append(Gx^<span class="number">3</span>+a*Gx+b-Gy^<span class="number">2</span>)</span><br><span class="line">I.append(G3x^<span class="number">3</span>+a*G3x+b-G3y^<span class="number">2</span>)</span><br><span class="line">res=Ideal(I).groebner_basis()</span><br><span class="line">a=<span class="built_in">int</span>(-res[<span class="number">0</span>].constant_coefficient())</span><br><span class="line">b=<span class="built_in">int</span>(-res[<span class="number">1</span>].constant_coefficient())</span><br><span class="line">lam1=(<span class="number">3</span>*Gx^<span class="number">2</span>+a)*<span class="built_in">pow</span>(<span class="number">2</span>*Gy,-<span class="number">1</span>,n)</span><br><span class="line">G2x=lam1^<span class="number">2</span>-<span class="number">2</span>*Gx</span><br><span class="line">G2y=lam1*(Gx-G2x)-Gy</span><br><span class="line">lam2=(G2y-Gy)*<span class="built_in">pow</span>(G2x-Gx,-<span class="number">1</span>,n)</span><br><span class="line">G3x_=lam2^<span class="number">2</span>-G2x-Gx</span><br><span class="line">p=<span class="built_in">int</span>(gcd(G3x_-G3x,n))</span><br><span class="line"><span class="keyword">assert</span> isPrime(p)</span><br><span class="line">q=n//p</span><br><span class="line">d=inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m=<span class="built_in">int</span>(<span class="built_in">pow</span>(c,d,n))</span><br><span class="line">a=a%p</span><br><span class="line">b=b%p</span><br><span class="line">flag=(a&lt;&lt;<span class="number">404</span>)+(b&lt;&lt;<span class="number">202</span>)+m</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(flag))</span><br><span class="line"><span class="comment">#$$U_c0u1d_s01v3_e11iptiCurv3_s0_34sily$$0f19d82199a0db0dee31fa12330307ea90aa</span></span><br></pre></td></tr></table></figure>
<h3 id="homo">homo</h3>
<p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;wmctf&#123;&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">flaglen = <span class="built_in">len</span>(flag) - <span class="number">7</span></span><br><span class="line">flag = bytes_to_long(flag[<span class="number">6</span>:-<span class="number">1</span>])</span><br><span class="line">pbit = <span class="number">114</span></span><br><span class="line">qbit = <span class="number">514</span></span><br><span class="line">rbit = <span class="number">191</span></span><br><span class="line">keylen = <span class="number">981</span></span><br><span class="line">nouse = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keygen</span>():</span><br><span class="line">    pk = []</span><br><span class="line">    sk = getPrime(qbit)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(keylen):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        p = getPrime(pbit)</span><br><span class="line">        r = getPrime(rbit)</span><br><span class="line">        pk.append(p*sk + <span class="number">2</span>*r)</span><br><span class="line">    <span class="keyword">return</span> pk , sk</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">m , pk</span>):</span><br><span class="line">    c = []</span><br><span class="line">    m = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">bin</span>(m)[<span class="number">2</span>:]]</span><br><span class="line">    <span class="built_in">print</span>(m)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">        tempc = i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(keylen):</span><br><span class="line">            <span class="keyword">if</span> randint(<span class="number">0</span> , <span class="number">1</span>):</span><br><span class="line">                tempc += pk[j]</span><br><span class="line">        c.append(tempc)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">pk , sk = keygen()</span><br><span class="line"><span class="built_in">print</span>(sk)</span><br><span class="line">c = enc(flag , pk)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;./pubkey.txt&#x27;</span> , <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(pk))</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;./cipher.txt&#x27;</span> , <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(<span class="built_in">str</span>(c))</span><br><span class="line">f.close()</span><br><span class="line"><span class="built_in">print</span>([(i%sk)%<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> c])</span><br><span class="line"><span class="built_in">print</span>(sk)</span><br></pre></td></tr></table></figure>
<p>怎么哪里都有homo啊！（恼）</p>
<p>还有你这个参数是怎么回事啊喂！</p>
<p>说正经的，本题的homo应该指的是同态加密（Homomorphic Encryption,
HE），而本题也正是整数上基于近似最大公因子（Approximate-GCD,
AGCD）的全同态加密方案（Fully Homomorphic Encryption,
FHE）。而该加密方案早在2012年被Gu
Chunsheng指出存在一种启发式攻击方法，能够借助格基规约算法，能在多项式时间内无需恢复secret
key（即本题中的<span
class="math inline">\(sk\)</span>）而直接还原明文。详情可具体参考论文，<a
target="_blank" rel="noopener" href="https://eprint.iacr.org/2012/157.pdf">论文链接</a>在此。</p>
<p>论文攻击的大致思想是，添加一种小的噪声项来消除<span
class="math inline">\(p*sk\)</span>部分的影响，从而根据奇偶性直接判断明文的比特位。整个过程可以巧妙利用公钥根据参数设置来构造格，并对规约出的最短基向量进行判断来完成。</p>
<p>好吧，其实原理也只是略懂一点，但是做题已经够了。根据该攻击方案可以写出对应的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">cipher=<span class="built_in">eval</span>(<span class="built_in">open</span>(<span class="string">&#x27;cipher.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read())</span><br><span class="line">pubkey=<span class="built_in">eval</span>(<span class="built_in">open</span>(<span class="string">&#x27;pubkey.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read())</span><br><span class="line">l=<span class="number">28</span></span><br><span class="line">res=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> cipher:</span><br><span class="line">	M=Matrix(ZZ,<span class="number">1</span>+l,<span class="number">2</span>+l)</span><br><span class="line">	col0=vector([c]+pubkey[<span class="number">1</span>:l]+[pubkey[<span class="number">0</span>]])</span><br><span class="line">	M.set_column(<span class="number">0</span>,col0)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>+l):</span><br><span class="line">		M[i,i+<span class="number">1</span>]=<span class="number">1</span></span><br><span class="line">	ML=M.LLL()</span><br><span class="line">	c1=[ i%<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> ML.column(<span class="number">0</span>)]</span><br><span class="line">	c2=[ i%<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> ML.column(<span class="number">1</span>)]</span><br><span class="line">	<span class="keyword">if</span> c1[:-<span class="number">1</span>]==c2[:-<span class="number">1</span>]:</span><br><span class="line">		res+=<span class="string">&#x27;1&#x27;</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		res+=<span class="string">&#x27;0&#x27;</span></span><br><span class="line">flag=long_to_bytes(<span class="built_in">int</span>(res,<span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment">#sodayo&gt;A&lt;!!$%!$_Easy_G@CDp_ATtaCk</span></span><br></pre></td></tr></table></figure>
<h3 id="nanodiamond-nanodiamond-rev">nanoDiamond &amp;
nanoDiamond-rev</h3>
<p>nanoDiamond-rev没搞出来，呜呜还是太菜了，这里先蹲一手大佬们的wp，到时复现一下。</p>
<p>nanoDiamond就先不码了，毕竟能打通后者肯定能打通前者。</p>
<h3 id="intercept">INTERCEPT</h3>
<p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256, sha512, md5</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint, seed, choice</span><br><span class="line"><span class="keyword">from</span> SECRET <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">KGC</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, lam</span>):</span><br><span class="line">        </span><br><span class="line">        self.lam = lam</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            self.z = <span class="number">2</span> * randint(<span class="number">1</span> &lt;&lt; <span class="number">63</span>, <span class="number">1</span> &lt;&lt; <span class="number">64</span>)</span><br><span class="line">            self.p = self.genPrime(self.z)</span><br><span class="line">            self.q = self.genPrime(<span class="number">2</span>)</span><br><span class="line">            self.N = (self.z * self.p + <span class="number">1</span>) * (<span class="number">2</span> * self.q + <span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            self.s1, self.s2 = randint(<span class="number">1</span>, self.N), randint(<span class="number">1</span>, self.N)</span><br><span class="line">            <span class="keyword">if</span> self.s1 % <span class="number">2</span> == self.s2 % <span class="number">2</span>: </span><br><span class="line">                self.s1 += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            self.g = randint(<span class="number">1</span>, self.N)</span><br><span class="line">            check = <span class="built_in">pow</span>(self.g, self.p * self.q, self.N) != <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">pow</span>(self.g, self.z * self.p, self.N) != <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">pow</span>(self.g, self.z * self.q, self.N) != <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> check:</span><br><span class="line">                self.g = randint(<span class="number">1</span>, self.N)</span><br><span class="line">                check = <span class="built_in">pow</span>(self.g, self.p * self.q, self.N) != <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">pow</span>(self.g, self.z * self.p, self.N) != <span class="number">1</span> <span class="keyword">and</span> <span class="built_in">pow</span>(self.g, self.z * self.q, self.N) != <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        self.g1, self.g2, self.g3 = (<span class="built_in">pow</span>(self.g, self.p * self.s1, self.N),</span><br><span class="line">                    <span class="built_in">pow</span>(self.g, self.p * self.s2, self.N),</span><br><span class="line">                    <span class="built_in">pow</span>(self.g, self.p ** <span class="number">2</span>, self.N))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">genPrime</span>(<span class="params">self, delta</span>):</span><br><span class="line">        prime = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> isPrime(prime):</span><br><span class="line">            prime = delta * getPrime(self.lam // <span class="number">2</span> - delta.bit_length()) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> (prime - <span class="number">1</span>) // delta</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">H1</span>(<span class="params">self, m</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(sha256(m.encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">H2</span>(<span class="params">self, m</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(sha512(m.encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">H3</span>(<span class="params">self, m</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(md5(m.encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">KeyGen</span>(<span class="params">self, username</span>):</span><br><span class="line">        h1, h2 = self.H1(username), self.H2(username)</span><br><span class="line">        y1 = invert(self.p, self.z * self.q) * h1 % (self.z * self.q)</span><br><span class="line">        y2 = invert(self.p, self.z * self.q) * h2 % (self.z * self.q)</span><br><span class="line">        d = invert(y1 * self.s1 + y2 * self.s2, self.z * self.q)</span><br><span class="line">        e = <span class="built_in">pow</span>(self.g1, h1, self.N) * <span class="built_in">pow</span>(self.g2, h2, self.N) % self.N</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> (y1, y2, d, h1, h2, e)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">self, m, user</span>):</span><br><span class="line">        length_limit = <span class="number">2</span>**<span class="number">128</span></span><br><span class="line">        r = randint(<span class="number">1</span>, self.N)</span><br><span class="line">        F = <span class="built_in">pow</span>(self.g3, r, self.N)</span><br><span class="line">        c1 = (m % length_limit) ^ self.H3(<span class="built_in">str</span>(F))</span><br><span class="line">        c2 = <span class="built_in">pow</span>(user.e, r, self.N)</span><br><span class="line">        <span class="keyword">return</span> (c1, c2)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dec</span>(<span class="params">self, c, user</span>):</span><br><span class="line">        c1, c2 = c</span><br><span class="line">        F = <span class="built_in">pow</span>(c2, user.d, self.N)</span><br><span class="line">        m = long_to_bytes(self.H3(<span class="built_in">str</span>(F)) ^ c1)</span><br><span class="line">        <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">USER</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, id_, kgc</span>):</span><br><span class="line">        self.id_ = id_</span><br><span class="line">        self.y1, self.y2, self.d, self.h1, self.h2, self.e = kgc.KeyGen(id_)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">print_info</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;e, d, h1, h2 = (<span class="subst">&#123;self.e&#125;</span>, <span class="subst">&#123;self.d&#125;</span>, <span class="subst">&#123;self.h1&#125;</span>, <span class="subst">&#123;self.h2&#125;</span>)&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">username, kgc</span>):</span><br><span class="line">    user = USER(username, kgc)</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">intercept</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            informant = <span class="string">&#x27;WMCTF_IS_FUN_&#x27;</span> + <span class="built_in">str</span>(getRandomNBitInteger(<span class="number">512</span>)) <span class="comment"># randomize a big string</span></span><br><span class="line">            USERLIST[informant] = register(informant, kgc)</span><br><span class="line">            INFORMATION = randint(<span class="number">1</span> &lt;&lt; <span class="number">127</span>, <span class="number">1</span> &lt;&lt; <span class="number">128</span>)</span><br><span class="line">            <span class="keyword">return</span> informant, INFORMATION</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">proof_of_work</span>():</span><br><span class="line">    seed(os.urandom(<span class="number">8</span>))</span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([choice(string.ascii_letters + string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = sha256(proof.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Give me XXXX: &#x27;</span>, end = <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    x = <span class="built_in">input</span>().strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256((x + proof[<span class="number">4</span>:]).encode()).hexdigest() != digest: </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">BANNER</span>():</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;        </span></span><br><span class="line"><span class="string">                                                  |--------------|                                                  </span></span><br><span class="line"><span class="string">                                                  |  [P]arams    |                                                  </span></span><br><span class="line"><span class="string">                                                  |  [R]egister  |                                                  </span></span><br><span class="line"><span class="string">                                                  |  [E]ncrypt   |                                                  </span></span><br><span class="line"><span class="string">                                                  |  [D]ecrypt   |                                                  </span></span><br><span class="line"><span class="string">                                                  |  [I]ntercept |                                                  </span></span><br><span class="line"><span class="string">                                                  |  [G]etflag   |                                                  </span></span><br><span class="line"><span class="string">                                                  |--------------|                                             </span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    LAM = <span class="number">512</span></span><br><span class="line">    LIMITED_USER_NUM = <span class="number">6</span></span><br><span class="line">    kgc = KGC(LAM)</span><br><span class="line">    USERLIST = &#123;&#125;</span><br><span class="line">    informant, INFORMATION = intercept()</span><br><span class="line">    </span><br><span class="line">    signal.alarm(<span class="number">5</span>)</span><br><span class="line">    BANNER()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        op = <span class="built_in">input</span>(<span class="string">&#x27;Input your choice please: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> op == <span class="string">&#x27;P&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Here gives you some params about the KGC: <span class="subst">&#123;kgc.N&#125;</span>, (<span class="subst">&#123;kgc.g1&#125;</span>, <span class="subst">&#123;kgc.g2&#125;</span>, <span class="subst">&#123;kgc.g3&#125;</span>)&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;R&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(USERLIST) &gt;= LIMITED_USER_NUM:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;No more new registration allowed!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            username = <span class="built_in">input</span>(<span class="string">&#x27;Input your name: &#x27;</span>).strip()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> username <span class="keyword">not</span> <span class="keyword">in</span> USERLIST:</span><br><span class="line">                    USERLIST[username] = register(username, kgc)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;Registration success, keep your account well!&#x27;</span>)</span><br><span class="line">                    USERLIST[username].print_info()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;This username has been taken!&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;Registration Not Allowed!&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;E&#x27;</span>:</span><br><span class="line">            username = <span class="built_in">input</span>(<span class="string">&#x27;Input your name: &#x27;</span>).strip()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> username <span class="keyword">in</span> USERLIST:</span><br><span class="line">                    message = <span class="built_in">input</span>(<span class="string">&#x27;Input your message in HEX: &#x27;</span>).strip()</span><br><span class="line">                    cipher = kgc.enc(<span class="built_in">int</span>(message, <span class="number">16</span>), USERLIST[username])</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&#x27;Here is the ciphertext: <span class="subst">&#123;cipher&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;This user does not exist!&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;Bad Request!&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;D&#x27;</span>:</span><br><span class="line">            username = <span class="built_in">input</span>(<span class="string">&#x27;Input your name: &#x27;</span>).strip()</span><br><span class="line">            prikey = <span class="built_in">input</span>(<span class="string">&#x27;Input your private key: &#x27;</span>).strip()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> username <span class="keyword">in</span> USERLIST <span class="keyword">and</span> USERLIST[username].d == prikey:</span><br><span class="line">                    c1, c2 = <span class="built_in">input</span>(<span class="string">&#x27;Input ciphers(c1, c2) in HEX: &#x27;</span>).strip()[<span class="number">1</span>:-<span class="number">1</span>].split(<span class="string">&#x27;, &#x27;</span>)[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">                    c1, c2 = <span class="built_in">int</span>(c1, <span class="number">16</span>), <span class="built_in">int</span>(c2, <span class="number">16</span>)</span><br><span class="line">                    m = kgc.dec((c1, c2), USERLIST[username])</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&#x27;Here is the message: <span class="subst">&#123;m&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;Bad Request!&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;Bad Request!&#x27;</span>)</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;I&#x27;</span>:</span><br><span class="line">            CIPHER = kgc.enc(INFORMATION, USERLIST[informant])</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;Here you intercepted a piece of message <span class="subst">&#123;CIPHER&#125;</span> sent by <span class="subst">&#123;informant&#125;</span>...&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;G&#x27;</span>:</span><br><span class="line">            message = <span class="built_in">str</span>(<span class="built_in">input</span>(<span class="string">&#x27;Input right messages in HEX and you\&#x27;ll get your bonus: &#x27;</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                message = <span class="built_in">int</span>(message, <span class="number">16</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;Illegal input!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> INFORMATION == message:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;Here is your flag: <span class="subst">&#123;FLAG&#125;</span>!&#x27;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;You really let me down..&#x27;</span>)</span><br><span class="line">            exit()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Have a nice day!&#x27;</span>)</span><br><span class="line">            exit()</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>题目代码很长，参数很多，看到第一眼就有种看不下去想放弃的感觉，但还是凭着学习的本心硬着头一点点啃下去了。</p>
<p>这里先大致捋一下题目的逻辑。</p>
<p>首先有一个全局KGC用于产生用户密钥，其中KGC中包含以下参数： <span
class="math display">\[
z=2 * randint(1 &lt;&lt; 63, 1 &lt;&lt; 64)\\
P=p*z+1, [p,P]\in prime,Pbits=256\\
Q=2*q+1, [q,Q]\in prime,Qbits=256\\
N=P*Q\\
s1= randint(1, N)\\ s2= randint(1, N)\\
s1\ne{s2}\mod 2\\
g = randint(1, N)\\
g^{p*q}\ne1\mod N,g^{z*p}\ne1\mod N,g^{z*q}\ne1\mod N\\
g1=g^{p*s1}\mod N\\ g2=g^{p*s2}\mod N\\ g3=g^{p*p}\mod N
\]</span> KGC公开参数<span
class="math inline">\((N,g1,g2,g3)\)</span>。</p>
<p>然后提供了用户注册功能，根据用户的id，KGC会为其分配公私钥，产生的公私钥的参数如下：
<span class="math display">\[
h1=H1(id),h2=H2(id),H1:=sha256,H2:=sha512\\
y1=p^{-1}*h1\mod z*q\\
y2=p^{-1}*h2\mod z*q\\
d=(y1*s1+y2*s2)^{-1}\mod z*q\\
e=g1^{h1}*g2^{h2}\mod N
\]</span> 其中<span
class="math inline">\((e,d,h1,h2)\)</span>参数用户保留可见。</p>
<p>接下来是用户加密消息功能，过程如下: <span class="math display">\[
r = randint(1, N)\\
F=g3^r \mod N\\
c1=m\bigoplus H3(F),H3:=md5\\
c2=e^r\mod N
\]</span> 密文为<span class="math inline">\((c1,c2)\)</span>。</p>
<p>同时提供解密功能，需要提供私钥<span
class="math inline">\(d\)</span>，其对应解密为： <span
class="math display">\[
F=c2^d\mod N\\
m=H3(F)\bigoplus c1
\]</span> 加解密的过程可以稍微手动推一下，是没有问题的~</p>
<p>然后回到题目的意图，题目模拟拦截了一个随机用户发送消息的流量，已知的只有该用户的id和该随机消息的密文。我们需要还原出该消息来提供给系统获取flag。可以利用的条件包括不超过6次的用户注册所提供的相关信息（用户id不能有相同），以及任意次数的加密解密功能。</p>
<p>常规思路就是尝试去获取该用户的私钥<span
class="math inline">\(d\)</span>了。我们从现有的已知条件和需求出发，已知不超过6组的<span
class="math inline">\((e_i,d_i,h1_i,h2_i)\)</span>，尝试获取指定的<span
class="math inline">\((h1_x,h2_x)\)</span>（用户id的哈希）对应的<span
class="math inline">\(d_x\)</span>。</p>
<p>这看起来似乎是可行的，我们先对一些公式做一些变形： <span
class="math display">\[
d=(y1*s1+y2*s2)^{-1}\mod z*q\\
\Rightarrow d*(y1*s1+y2*s2)=1\mod z*q\\
\Rightarrow p*d*(y1*s1+y2*s2)=p\mod z*q\\
\Rightarrow d*(h1*s1+h2*s2)=p\mod z*q
\]</span> 这样一来，我们将未知参数<span
class="math inline">\((y1,y2)\)</span>用已知参数<span
class="math inline">\((h1,h2)\)</span>来表示。</p>
<p>由于<span
class="math inline">\(p\)</span>是KGC的共用参数，那么对于任意两组<span
class="math inline">\((d_i,h1_i,h2_i)\)</span>和<span
class="math inline">\((d_j,h1_j,h2_j)\)</span>，我们有： <span
class="math display">\[
d_i*(h1_i*s1+h2_i*s2)=d_j*(h1_j*s1+h2_j*s2)\mod z*q\\
\Rightarrow s1*(d_i*h1_i-d_j*h1_j)=s2*(d_j*h2_j-di*h2_i)\mod z*q
\]</span> 这里<span
class="math inline">\((s1,s2,z*q)\)</span>未知。但仔细观察该式特点，我们再使用两组<span
class="math inline">\((d_i,h1_i,h2_i)\)</span>和<span
class="math inline">\((d_j,h1_j,h2_j)\)</span>来构造以上关系，然后等式两边交换相乘即可同时消去<span
class="math inline">\(s1\)</span>和<span
class="math inline">\(s2\)</span>！也就是说我们可以拿到仅用已知参数<span
class="math inline">\((d,h1,h2)\)</span>来表示的，且模<span
class="math inline">\(z*q\)</span>为0的式子！那么故技重施再算一次，然后求gcd，即可拿到模数<span
class="math inline">\(z*q\)</span>。</p>
<p>后面就比较简单了，我们可以根据 <span class="math display">\[
s1*(d_i*h1_i-d_j*h1_j)=s2*(d_j*h2_j-di*h2_i)\mod z*q\\
\Rightarrow s1=s2*{ {d_j*h2_j-di*h2_i}\over{d_i*h1_i-d_j*h1_j} } \mod
z*q
\]</span> 得到<span class="math inline">\(s1\)</span>和<span
class="math inline">\(s2\)</span>之间的线性关系（无需求出<span
class="math inline">\(s1\)</span>和<span
class="math inline">\(s2\)</span>的值），假设为<span
class="math inline">\(s1=s2*k \mod z*q\)</span></p>
<p>因此有： <span class="math display">\[
d_i*(h1_i*s1+h2_i*s2)=d_j*(h1_j*s1+h2_j*s2)\mod z*q\\
\Rightarrow d_i*(h1_i*k+h2_i)=d_j*(h1_j*k+h2_j)\mod z*q
\]</span> 因此对于指定<span
class="math inline">\((h1_x,h2_x)\)</span>，对任意<span
class="math inline">\(i\)</span>我们有： <span class="math display">\[
d_x=d_i*{ {h1_i*k+h2_i}\over{h1_x*k+h2_x} }
\]</span> 这样就求出了该用户的私钥<span
class="math inline">\(d_x\)</span>！</p>
<p>注意这里由于gcd和取模运算等原因，该<span
class="math inline">\(d_x\)</span>可能不是准确值，因此提交到系统的解密功能中可能会出错。但我们手动进行解密仍然能计算出正确的消息明文。</p>
<p>该题至此已经解出。然而比赛时还有坑的一点是，由于用户id和消息是随机的，因此很多地方的求逆运算结果都是不存在逆元，因此想要使程序按正确路线跑完还是比较费劲的，得多跑几次（一度怀疑自己的推理逻辑对不对，还重新看了好几遍）。加之服务器产生KGC参数有时非常慢，当时我是做吐了—_—!</p>
<p>解出后和出题人交流过程中，发现该解法竟是非预期。预期解是打穿KGC???再蹲一波预期解好吧~</p>
<p>解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256,sha512,md5</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product,combinations,permutations</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">sh=remote(<span class="string">&#x27;1.13.154.182&#x27;</span>,<span class="number">30126</span>)</span><br><span class="line">l64 = <span class="keyword">lambda</span>      :u64(sh.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>))</span><br><span class="line">l32 = <span class="keyword">lambda</span>      :u32(sh.recvuntil(<span class="string">&quot;\xf7&quot;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">&quot;\x00&quot;</span>))</span><br><span class="line">sla = <span class="keyword">lambda</span> a,b  :sh.sendlineafter(<span class="built_in">str</span>(a),<span class="built_in">str</span>(b))</span><br><span class="line">sa  = <span class="keyword">lambda</span> a,b  :sh.sendafter(<span class="built_in">str</span>(a),<span class="built_in">str</span>(b))</span><br><span class="line">lg  = <span class="keyword">lambda</span> name,data : sh.success(name + <span class="string">&quot;: 0x%x&quot;</span> % data)</span><br><span class="line">se  = <span class="keyword">lambda</span> payload: sh.send(payload)</span><br><span class="line">rl  = <span class="keyword">lambda</span>      : sh.recvline()</span><br><span class="line">rv  = <span class="keyword">lambda</span> n    : sh.recv(n)</span><br><span class="line">sl  = <span class="keyword">lambda</span> payload: sh.sendline(payload)</span><br><span class="line">ru  = <span class="keyword">lambda</span> a     :sh.recvuntil(<span class="built_in">str</span>(a))</span><br><span class="line">rud  = <span class="keyword">lambda</span> a     :sh.recvuntil(<span class="built_in">str</span>(a),drop=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_pow</span>():</span><br><span class="line">    s=rl().decode()</span><br><span class="line">    suffix,val=re.findall(<span class="string">&#x27;sha256\(XXXX\+(\w&#123;16&#125;)\) == ([0-9a-f]&#123;64&#125;)&#x27;</span>,s)[<span class="number">0</span>]</span><br><span class="line">    tab=string.digits + string.ascii_letters</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> product(tab,repeat=<span class="number">4</span>):</span><br><span class="line">        ans=<span class="string">&#x27;&#x27;</span>.join(item)</span><br><span class="line">        <span class="keyword">if</span> sha256((ans+suffix).encode()).hexdigest()==val:</span><br><span class="line">            sla(<span class="string">&#x27;XXXX: &#x27;</span>,ans)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Param</span>():</span><br><span class="line">    sla(<span class="string">&#x27;choice please: &#x27;</span>,<span class="string">&#x27;P&#x27;</span>)</span><br><span class="line">    ru(<span class="string">&#x27;about the KGC: &#x27;</span>)</span><br><span class="line">    N=<span class="built_in">int</span>(rud(<span class="string">&#x27;, (&#x27;</span>))</span><br><span class="line">    g1=<span class="built_in">int</span>(rud(<span class="string">&#x27;, &#x27;</span>))</span><br><span class="line">    g2=<span class="built_in">int</span>(rud(<span class="string">&#x27;, &#x27;</span>))</span><br><span class="line">    g3=<span class="built_in">int</span>(rud(<span class="string">&#x27;)\n&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> N,g1,g2,g3</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Intercept</span>():</span><br><span class="line">    sla(<span class="string">&#x27;choice please: &#x27;</span>,<span class="string">&#x27;I&#x27;</span>)</span><br><span class="line">    ru(<span class="string">&#x27;of message &#x27;</span>)</span><br><span class="line">    cipher=rud(<span class="string">&#x27; sent by &#x27;</span>)</span><br><span class="line">    informant=rud(<span class="string">&#x27;...\n&#x27;</span>).decode()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(cipher),informant</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Register</span>(<span class="params">name</span>):</span><br><span class="line">    sla(<span class="string">&#x27;choice please: &#x27;</span>,<span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">    sla(<span class="string">&#x27;Input your name: &#x27;</span>,<span class="built_in">str</span>(name))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Not Allowed!&#x27;</span> <span class="keyword">in</span> rl():</span><br><span class="line">        name=bytes_to_long(name.encode())</span><br><span class="line">        new_name=long_to_bytes(name+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> Register(new_name.decode())</span><br><span class="line">    info=rl()[<span class="number">16</span>:-<span class="number">2</span>].decode()</span><br><span class="line">    e,d,h1,h2=<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,info.split(<span class="string">&#x27;, &#x27;</span>)))</span><br><span class="line">    <span class="keyword">return</span> e,d,h1,h2,name</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Decrypt</span>(<span class="params">name,d,c1,c2</span>):</span><br><span class="line">    sla(<span class="string">&#x27;choice please: &#x27;</span>,<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">    sla(<span class="string">&#x27;Input your name: &#x27;</span>,name)</span><br><span class="line">    sla(<span class="string">&#x27;private key: &#x27;</span>,d)</span><br><span class="line">    cip=<span class="string">f&#x27;(<span class="subst">&#123;c1&#125;</span>, <span class="subst">&#123;c2&#125;</span>)&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Bad&#x27;</span> <span class="keyword">in</span> rl():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    sl(cip)</span><br><span class="line">    ru(<span class="string">&#x27;message: &#x27;</span>)</span><br><span class="line">    message=rl()[:-<span class="number">1</span>].decode()</span><br><span class="line">    <span class="keyword">return</span> message</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GetFlag</span>(<span class="params">m</span>):</span><br><span class="line">    sla(<span class="string">&#x27;choice please: &#x27;</span>,<span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">    sla(<span class="string">&#x27;bonus: &#x27;</span>,<span class="built_in">hex</span>(m)[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    solve_pow()</span><br><span class="line">    N,g1,g2,g3=Param()</span><br><span class="line">    CIPHER,informant=Intercept()</span><br><span class="line">    c1,c2=CIPHER</span><br><span class="line">    H1=<span class="built_in">int</span>(sha256(informant.encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    H2=<span class="built_in">int</span>(sha512(informant.encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    e1,d1,h11,h21,name1=Register(<span class="string">&#x27;zealot_aaa&#x27;</span>)</span><br><span class="line">    e2,d2,h12,h22,name2=Register(<span class="string">&#x27;zealot_bbb&#x27;</span>)</span><br><span class="line">    e3,d3,h13,h23,name3=Register(<span class="string">&#x27;zealot_ccc&#x27;</span>)</span><br><span class="line">    e4,d4,h14,h24,name4=Register(<span class="string">&#x27;zealot_ddd&#x27;</span>)</span><br><span class="line">    e5,d5,h15,h25,name5=Register(<span class="string">&#x27;zealot_eee&#x27;</span>)</span><br><span class="line">    arr=[(e1, d1, h11, h21),(e2, d2, h12, h22),(e3, d3, h13, h23),(e4, d4, h14, h24),(e5, d5, h15, h25)]</span><br><span class="line">    tmp=[]</span><br><span class="line">    <span class="keyword">for</span> a,b,c <span class="keyword">in</span> permutations(arr,<span class="number">3</span>):</span><br><span class="line">        l=(a[<span class="number">1</span>]*a[<span class="number">2</span>]-b[<span class="number">1</span>]*b[<span class="number">2</span>])*(c[<span class="number">1</span>]*c[<span class="number">3</span>]-a[<span class="number">1</span>]*a[<span class="number">3</span>])</span><br><span class="line">        r=(b[<span class="number">1</span>]*b[<span class="number">3</span>]-a[<span class="number">1</span>]*a[<span class="number">3</span>])*(a[<span class="number">1</span>]*a[<span class="number">2</span>]-c[<span class="number">1</span>]*c[<span class="number">2</span>])</span><br><span class="line">        tmp.append(l-r)</span><br><span class="line">    zq=reduce(GCD,tmp)</span><br><span class="line">    <span class="comment">#print(zq)</span></span><br><span class="line">    <span class="comment">#print(zq.bit_length())</span></span><br><span class="line">    <span class="comment">#s1=k*s2</span></span><br><span class="line">    klist=[]</span><br><span class="line">    <span class="keyword">for</span> a,b <span class="keyword">in</span> permutations(arr,<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            t=((a[<span class="number">1</span>]*a[<span class="number">3</span>]-b[<span class="number">1</span>]*b[<span class="number">3</span>])*invert(b[<span class="number">1</span>]*b[<span class="number">2</span>]-a[<span class="number">1</span>]*a[<span class="number">2</span>],zq))%zq</span><br><span class="line">            klist.append(t)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">    klist=<span class="built_in">list</span>(<span class="built_in">set</span>(klist))</span><br><span class="line">    <span class="built_in">print</span>(klist)</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">len</span>(klist)!=<span class="number">1</span>):</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    D=d1*(h11*klist[<span class="number">0</span>]+h21)*invert(H1*klist[<span class="number">0</span>]+H2,zq)%zq</span><br><span class="line">    F=<span class="built_in">pow</span>(c2,D,N)</span><br><span class="line">    HF=<span class="built_in">int</span>(md5(<span class="built_in">str</span>(F).encode()).hexdigest(), <span class="number">16</span>)</span><br><span class="line">    m=c1^HF</span><br><span class="line">    GetFlag(m)</span><br><span class="line"></span><br><span class="line">solve()</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br><span class="line"><span class="comment">#WMCTF&#123;cracking_such_a_toy_system_is_so_easy!&#125;</span></span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>WMCTF2022 Crypto wp</p><p><a href="https://litao6666.github.io/202208/ebfe4390.html">https://litao6666.github.io/202208/ebfe4390.html</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><a href="https://litao6666.github.io"><p>zealot</p></a></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-08-22</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-08-27</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/202209/ef27fca5.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">2022羊城杯Crypto wp</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/202208/960e02cb.html"><span class="level-item">2022巅峰极客Crypto wp</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="is-flex is-mobile" href="#ecc"><span>ecc</span></a></li><li><a class="is-flex is-mobile" href="#homo"><span>homo</span></a></li><li><a class="is-flex is-mobile" href="#nanodiamond-nanodiamond-rev"><span>nanoDiamond &amp;
nanoDiamond-rev</span></a></li><li><a class="is-flex is-mobile" href="#intercept"><span>INTERCEPT</span></a></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">zealot&#039;s blog</a><p class="size-small"><span>&copy; 2023 zealot</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noreferrer">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noreferrer">Icarus</a> &amp; <a href="https://github.com/LittleYe233/hexo-theme-amazingremake" target="_blank" rel="noreferrer">Amazing-Remake</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><div class="size-small"><span>❤️Thx <strong><span id="busuanzi_value_site_uv">99+</span></strong> users <strong><span id="busuanzi_value_site_pv">99+</span></strong> visited!❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/LittleYe233/hexo-theme-amazingremake"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    enabled: true,
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/column.min.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/main.min.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { // 加载mathjax
            window.MathJax = {
                tex: {
                    inlineMath: [['$', '$']],
                    autoload: {
                        color: [],
                        colorv2: ['color']
                    },
                    packages: {'[+]': ['noerrors']}
                },
                options: {
                    ignoreHtmlClass: 'tex2jax_ignore',
                    processHtmlClass: 'tex2jax_process'
                },
                loader: {
                    load: ['input/asciimath', '[tex]/noerrors']
                }
            };
            $.getScript('//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js');
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(false){
                $.getScript('https://cdn.jsdelivr.net/gh/litao6666/litao6666.github.io/js/comment-issue-data.min.js',function(){loadIssueData('','','','',false);});
            }
            if('undefined' === 'mathjax'){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>